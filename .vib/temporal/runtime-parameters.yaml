useHelmHooks: false
logLevel: info
frontend:
  podSecurityContext:
    fsGroup: 1002
  containerSecurityContext:
    runAsUser: 1002
  containerPorts:
    rpc: 8233
    http: 8243
    membership: 7933
    metrics: 9091
  automountServiceAccountToken: true
  service:
    ports:
      rpc: 18233
      http: 18243
history:
  podSecurityContext:
    fsGroup: 1002
  containerSecurityContext:
    runAsUser: 1002
  containerPorts:
    rpc: 8234
    membership: 7934
    metrics: 9091
matching:
  podSecurityContext:
    fsGroup: 1002
  containerSecurityContext:
    runAsUser: 1002
  containerPorts:
    rpc: 8235
    membership: 7935
    metrics: 9091
worker:
  podSecurityContext:
    fsGroup: 1002
  containerSecurityContext:
    runAsUser: 1002
  containerPorts:
    membership: 7939
    metrics: 9091
metrics:
  enabled: true
  service:
    ports:
      metrics: 9091
defaultInitContainers:
  waitForDB:
    containerSecurityContext:
      runAsUser: 1002
  renderConfig:
    containerSecurityContext:
      runAsUser: 1002
setupDBJob:
  podSecurityContext:
    fsGroup: 1002
  containerSecurityContext:
    runAsUser: 1002
web:
  containerPorts:
    http: 8081
  sidecars:
    - image: registry.app-catalog.vmware.com/eam/prd/containers/verified/common/minideb-bookworm/apache:latest
      name: apache
      securityContext:
        runAsNonRoot: true
        privileged: false
        allowPrivilegeEscalation: false
        capabilities:
          drop: ["ALL"]
        seccompProfile:
          type: "RuntimeDefault"
      ports:
        - name: proxy-https
          containerPort: 8443
      volumeMounts:
        - name: apache-vhosts
          mountPath: /vhosts
      livenessProbe:
        tcpSocket:
          port: proxy-https
      readinessProbe:
        httpGet:
          path: /
          port: proxy-https
          scheme: HTTPS
  extraVolumes: |-
    - name: apache-vhosts
      configMap:
        name: {{ printf "%s-apache-config" (include "common.names.fullname" .) }}
  networkPolicy:
    extraIngress:
      - ports:
        - port: 8443
          protocol: TCP
  service:
    extraPorts:
    - name: https
      port: 443
      targetPort: proxy-https
      protocol: TCP
extraDeploy:
  - |
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: {{ printf "%s-apache-config" (include "common.names.fullname" .) }}
    data:
      temporal-vhost.conf: |-
        <VirtualHost 127.0.0.1:8443 _default_:8443>
          ServerName www.example.com
          ServerAlias *

          SSLEngine on
          SSLCertificateFile "/opt/bitnami/apache/conf/bitnami/certs/tls.crt"
          SSLCertificateKeyFile "/opt/bitnami/apache/conf/bitnami/certs/tls.key"

          RequestHeader set X-Forwarded-Proto "https"
          ProxyPreserveHost on

          SSLProxyEngine on

          ProxyPass / http://127.0.0.1:{{ .Values.web.containerPorts.http }}/
          ProxyPassReverse / http://127.0.0.1:{{ .Values.web.containerPorts.http }}/
        </VirtualHost>
